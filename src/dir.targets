<Project ToolsVersion="12.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="..\dir.targets" />

  <PropertyGroup>
    <!-- Don't copy NuGet implementations directly, since that would require setting a runtime and targeting a specific architecture.
         Instead, it they will be deployed by DeployDependencies.proj. -->
    <CopyNuGetImplementations>false</CopyNuGetImplementations>
    
    <!-- Override in-box Microsoft.NuGet.targets with the version from the Microsoft.DotNet.BuildTools package-->
    <NuGetTargets>$(ToolsDir)\Microsoft.NuGet.targets</NuGetTargets>
  </PropertyGroup>

  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" Condition="('$(NetCoreBuild)' != 'true' or '$(OsEnvironment)'!='Windows_NT') and Exists('$(MSBuildToolsPath)\Microsoft.CSharp.targets')"/>
  <Import Project="$(MSBuildExtensionsPath32)\Microsoft\Portable\$(TargetFrameworkVersion)\Microsoft.Portable.CSharp.targets" Condition="'$(NetCoreBuild)' == 'true' and '$(OsEnvironment)'=='Windows_NT'"/>

  <!-- If NuGet targets haven't been imported via Microsoft.Common.Targets\Microsoft.NuGet.ImportAfter.targets -->
  <Import Project="$(NuGetTargets)" Condition="'$(NuGetTargetsImported)'!='true'" />

  <!-- OSS sign assemblies after compile runs. -->
  <Import Condition="Exists('$(ToolsDir)\sign.targets')" Project="$(ToolsDir)\sign.targets" />

  <!-- Use NuSpec.ReferenceGenerator to create / update the .NET Core dependencies of the packages -->
  <Import Condition="'$(NetCoreBuild)'=='true' and Exists('$(NuSpecReferenceGeneratorDir)\NuSpec.ReferenceGenerator.targets')"  Project="$(NuSpecReferenceGeneratorDir)\NuSpec.ReferenceGenerator.targets"/>

  <Import Condition="'$(OsEnvironment)'!='Windows_NT' and Exists('../override.targets')"  Project="../override.targets" />

  <!-- Debugging support -->
  <PropertyGroup Condition="'$(NetCoreBuild)' == 'true'">
    <DebugEngines>{2E36F1D4-B23C-435D-AB41-18E608940038}</DebugEngines>
    <TestHost Condition="'$(OsEnvironment)' == 'Windows_NT'">CoreRun.exe</TestHost>
    <TestHost Condition="'$(OsEnvironment)' != 'Windows_NT'">corerun</TestHost>
    <StartProgram Condition="'$(StartProgram)'==''">$(DeploymentDir)\$(TestHost)</StartProgram>
    <StartArguments>msbuild.exe</StartArguments>
  </PropertyGroup>


  <PropertyGroup Condition="'$(NetCoreBuild)' == 'true' And '$(IsTestProject)'=='true'">
    <StartArguments>xunit.console.netcore.exe $(TargetFileName) $(XunitOptions)</StartArguments>
    <StartAction>Program</StartAction>
  </PropertyGroup>

  <PropertyGroup Condition="'$(NetCoreBuild)' == 'true'">
    <NuGetTargetMoniker>DNXCore,Version=v5.0</NuGetTargetMoniker>
  </PropertyGroup>

</Project>
